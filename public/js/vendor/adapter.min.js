/*! bitflopme 2013-11-25 */
function trace(text){"\n"==text[text.length-1]&&(text=text.substring(0,text.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+text)}var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;navigator.mozGetUserMedia?(webrtcDetectedBrowser="firefox",RTCPeerConnection=mozRTCPeerConnection,console.log(mozRTCPeerConnection),RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),createIceServer=function(turn_url,username,password){var iceServer={url:turn_url,credential:password,username:username};return iceServer},attachMediaStream=function(element,stream){console.log("Attaching media stream"),element.mozSrcObject=stream,element.play()},reattachMediaStream=function(to,from){console.log("Reattaching media stream"),to.mozSrcObject=from.mozSrcObject,to.play()}):navigator.webkitGetUserMedia?(webrtcDetectedBrowser="chrome",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2]),createIceServer=28>webrtcDetectedVersion?function(turn_url,username,password){var iceServer={url:"turn:"+username+"@"+turn_url,credential:password};return iceServer}:function(turn_url,username,password){var iceServer={url:turn_url,credential:password,username:username};return iceServer},RTCPeerConnection=webkitRTCPeerConnection,getUserMedia=navigator.webkitGetUserMedia.bind(navigator),attachMediaStream=function(element,stream){"undefined"!=typeof element.srcObject?element.srcObject=stream:"undefined"!=typeof element.mozSrcObject?element.mozSrcObject=stream:"undefined"!=typeof element.src?element.src=URL.createObjectURL(stream):console.log("Error attaching stream to element.")},reattachMediaStream=function(to,from){to.src=from.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})):console.log("Browser does not appear to be WebRTC-capable");